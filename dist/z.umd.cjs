!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).z={})}(this,(function(t){"use strict";var e=Object.defineProperty,n=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);function r(t,e){t.innerHTML="",t.appendChild(e())}function o(t="",e=6){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="1234567890";let o=t;const i=Date.now(),s=n.charAt(Math.floor(26*Math.random())),a=r.charAt(Math.floor(10*Math.random()));if(!t)for(let c=0;c<e;c++)o+=n.charAt(Math.floor(26*Math.random()));return o+=`_${i}${s}${a}`,o}const i=/* @__PURE__ */new Map;let s;const a=/* @__PURE__ */new Set;function c(t,e,n){const r=t.tagName.toLowerCase(),o=function(t,e,n){const r={};return Array.from(t.attributes).forEach((t=>{const o=t.value.trim(),i=e.find((t=>t.name===o));if(i)r[t.name]=i.fn;else{const e=n.find((t=>t.name===o));r[t.name]=e?e.name:t.value}})),r}(t,e,n);return{type:r,content:Array.from(t.childNodes).filter((t=>t.nodeType===Node.TEXT_NODE)).map((t=>t.textContent.trim())).join(""),attributes:o,children:Array.from(t.childNodes).filter((t=>t.nodeType===Node.ELEMENT_NODE)).map((t=>c(t,e,n))),elements:n}}function l(t,e){const{type:n,content:r,attributes:i,children:s,elements:a}=t,c=document.createElement(n);if(!c.hasAttribute("_id")){const t=o("ELEMENT");c.setAttribute("_id",t),e&&e.size>0&&e.forEach((e=>e.elementInDom=t))}r&&(c.textContent=r);for(const[o,l]of Object.entries(i))if(o.startsWith("on")){const t=o.slice(2).toLowerCase();"change"===t?c.addEventListener("input",l):c.addEventListener(t,l)}else c.setAttribute(o,l);return s&&s.forEach((t=>{const e=l(t);c.appendChild(e)})),Array.from(c.querySelectorAll("div[_id]")).forEach((t=>{const e=t.getAttribute("_id"),n=a.find((t=>t.name===e));n&&t.replaceWith(n.element)})),c}const{channels:d}=new function(t={}){let e=[],n=t.plugins||[],r={};n.length>0&&n.forEach((t=>{const e=t.name||"UnNamedPlugin";r[e]=t}));const o=t=>e[t].state,i=(t,n)=>{const r=e[t];let o=r.state;for(const e of r.activePlugins)if(e.getter){const t=e.getter.method(o,e.getter.options);o={...o,...t}}return((t,n)=>{((null==n?void 0:n.auto)??1)&&s(t,(()=>e[t].state));return e[t].state})(t,n)},s=(t,n)=>{e[t].subscribers.add(n)},a=t=>{e[t].subscribers.forEach((n=>n(e[t].state)))},c=(t,e)=>{let n=o(t),r=e;return"function"==typeof e&&(r=e(n)),l(t,r)},l=(t,n)=>{let r=e[t].state;return e[t].state=n,e[t].history.length<=10||(e[t].history=[]),e[t].history.push(r),a(t),e[t].state},d=async(t,n)=>{const r=e[t],i=u(r.middleWares,t);let s=o(t),a=n;"function"==typeof n&&(a=n(s));try{const e=await i(a);return l(t,e)}catch(c){}},u=(t,e)=>t.reduce(((t,e,n)=>async(n,...r)=>{try{const o=await t(n,...r);return await e(o,...r)}catch(o){throw o}}));return{channels:{getChannels:()=>e,getChannel:t=>e[t]?e[t]:null,addChannel:(t,n={})=>(e[t]={name:t,activePlugins:[],subscribers:/* @__PURE__ */new Set,state:n,middleWares:[],history:[],setState:n=>((t,n)=>{const r=e[t];let i=o(t),s=n;"function"==typeof n&&(s=n(i));for(const e of r.activePlugins)e.setter&&(s=e.setter.method(s,e.setter.options));return c(t,s)})(t,n),setStateAsync:e=>d(t,e),getState:e=>i(t,e),getHistory:()=>(t=>e[t].history)(t),addMiddleWares:(...n)=>((t,...n)=>{let r=e[t].middleWares;return e[t].middleWares=[...r,...n],e[t].middleWares})(t,...n),subscribe:e=>s(t,e),unSubscribe:n=>((t,n)=>{e[t].subscribers.delete(n)})(t,n),notifySubscribers:t=>a(t),usePlugin:n=>((t,n)=>{const o=r[n]||null;o&&(e[t].activePlugins.push(o),(o.exposes||[]).forEach((n=>{e[t][n.name]=(...r)=>n.method(e[t].state,...r)})))})(t,n)},e[t]),removeChannel:t=>{if(e[t]){const n=Object.keys(e).filter((e=>e!==t)).reduce(((t,n)=>(t[n]=e[n],t)),{});e=n}return e}}}},u=d;class f extends HTMLElement{constructor(){super(...arguments),n(this,"_handleClick",(t=>{t.preventDefault();const e=this.getAttribute("to")||"/",n=this.getAttribute("target"),r=new CustomEvent("z-navigate",{bubbles:!0,detail:{path:e,target:n}});this.dispatchEvent(r)}))}connectedCallback(){this.addEventListener("click",this._handleClick),this.style.cursor="pointer"}disconnectedCallback(){this.removeEventListener("click",this._handleClick)}}function h(t={}){const e=t.parent||document.body,n=t.routes||[],o=t.initialDelay||0,i=(t,o={})=>{const i=o.target||e,s=(t=>{const e=t.startsWith("/")?t:`/${t}`;if(e.endsWith("/index.html"))return n.find((t=>"/"===t.route));const r=n.find((t=>t.route===e));return r||n.find((t=>"/*"===t.route))})(t),a=o.component||(null==s?void 0:s.component);if(a){let e=t.endsWith("/index.html")?"/":t;e=e.startsWith("/")?e:`/${e}`,o.replaceState?history.replaceState({},"",e):history.pushState({},"",e),r(i,a)}},s=t=>{const{path:e,target:n}=t.detail;if(a(t.target),n){const t=document.getElementById(n);t&&i(e,{target:t})}else i(e)},a=t=>{e.querySelectorAll("z-link").forEach((e=>{e.classList.toggle("active",e===t)}))},c=()=>{const t=window.location.pathname+window.location.search;i(t,{replaceState:!0})},l=()=>{0!==n.length&&(e.addEventListener("z-navigate",s),window.addEventListener("popstate",c),(()=>{const t=window.location.pathname+window.location.search;i(t,{replaceState:!0})})())};return o>0?setTimeout(l,o):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),{history:window.history,location:window.location,goTo:i,goBack:()=>window.history.back(),goForward:()=>window.history.forward(),getParam:t=>{const e=new URLSearchParams(window.location.search);return e.has(t)?e.get(t):null},reloadRouter:l}}customElements.define("z-link",f);let m=null;t.$=function(t){const e=t();return a&&a.size>0&&a.forEach((e=>{e.subscribe((()=>{let n=document.querySelector(`[_id="${e.elementInDom}"]`),r=t();n&&n.replaceWith(r)}))})),e},t.css=function(t,...e){s||(s=document.createElement("style"),document.head.appendChild(s));const n=t.reduce(((t,n,r)=>t+n+(e[r]||"")),""),r="css-"+function(t){let e=5381;for(let n=0;n<t.length;n++)e=(e<<5)+e+t.charCodeAt(n);return e.toString(36)}(n);if(i.has(r))return i.get(r);const o=`.${r} { ${n} }`;return s.innerHTML+=o,i.set(r,r),r},t.html=function(t,...e){const n=[],r=[];a.clear();const i=t.reduce(((t,n,r)=>{if("function"==typeof e[r])return t+n+`__FUNCTION_${r}__`;if(e[r]instanceof HTMLElement){const i=e[r].getAttribute("_id")||o("ELEMENT");return e[r].setAttribute("_id",i),t+n+`<div _id="${i}"></div>`}return t+(void 0!==e[r]?function(t,e){let n=e;return"object"==typeof t&&t.hasOwnProperty("value")?(e.includes("stateful")&&(n=e.replace("stateful",`stateful="${t.id}"`)),a.add(t),n+t.current()):n+t}(e[r],n):"")}),"");return e.forEach(((t,e)=>{if("function"==typeof t)n.push({name:`__FUNCTION_${e}__`,fn:t});else if(t instanceof HTMLElement){const e=t.getAttribute("_id")||o("ELEMENT");t.setAttribute("_id",e),r.push({name:e,element:t})}})),l(c((new DOMParser).parseFromString(i,"text/html").body.firstChild,n,r),a)},t.render=(t=null,e=[],n=0)=>{if(!t)return;if(0===e.length)return;return r(t,e.find((t=>"/"===t.route)).component),t&&e.length>0&&(m=new h({routes:e,parent:t,initialDelay:n})),m},t.store=u,t.useEffect=function(t,e){0!==e.length?e.forEach((e=>{let n=u.getChannel(e.id);n&&n.subscribe(t)})):window.addEventListener("DOMContentLoaded",t())},t.useRouter=()=>m,t.useState=function(t){let e=o("state",12),n=d.addChannel(e,t);return[{id:e,current:()=>n.getState(),subscribe:t=>n.subscribe(t),value:n.getState()},n.setState,n]},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
